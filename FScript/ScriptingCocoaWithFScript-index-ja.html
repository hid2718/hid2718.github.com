<html><head>
    <title>
      F-Script で Cocoa スクリプティング - Scripting Cocoa with F-Script
    </title>
    <!-- Scripting Cocoa with F-Script -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"> -->
    <link rel="stylesheet" type="text/css" href="ScriptingCocoaWithFScript-index-ja_files/documentation.css" media="all">
    <style type="text/css" media="all">   
    </style>
  </head>
  <body bgcolor="#FFFFFF">
    <br>
	<h1 align="center">
	  F-Script で Cocoa スクリプティング
	  <!-- Scripting Cocoa With F-Script -->
	</h1>
    <p>
      <font color="#326fa3">
	2009年 8月 改訂
	<!-- Revised August 2009 -->
      </font>
    </p>
    
    
	<table style="border: 1px solid #C9D1D7; width:38em" bgcolor="whitesmoke" cellpadding="5">
	<!-- <table style="border: 1px solid #C9D1D7; width:43em" bgcolor="whitesmoke" cellpadding="5"> -->
	  <tbody><tr>
		  <td align="left">
			<b>
			  記事一覧
			  <!-- Articles in this series -->
			</b><br>
			<br>
			<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			  基 礎
			  <!-- Fundamentals -->
			</b><br>
			<ol>
			  <li>
				<a href="ExploringCocoaWithFScript-index-ja.html">
				  F-Script で Cocoa 探検
				</a>
				<a href="http://www.fscript.org/documentation/ExploringCocoaWithFScript/index.htm">
				  ［原文］
				</a>
			  </li>
			  <li>
				<a href="LearnFScriptIn20Minutes-index-ja.html">
				  F-Script を20分で学び、Core Image で遊んでみよう
				</a>
				<a href="http://www.fscript.org/documentation/LearnFScriptIn20Minutes/index.htm">
				  ［原文］
				</a>
			  </li>
			  <li>
				<a href="ScriptingCocoaWithFScript-index-ja.html">
				  F-Script で Cocoa スクリプティング
				</a>
				<a href="http://www.fscript.org/documentation/ScriptingCocoaWithFScript/index.htm">
				  ［原文］
				</a>
			  </li>
			  <li>
				<a href="CreatingCocoaClassesWithFScript-index-ja.html">
				  F-Script で Cocoa クラスを創る
				</a>
				<a href="http://www.fscript.org/documentation/CreatingCocoaClassesWithFScript/index.htm">
				  ［原文］
				</a>
			  </li>
			  <li>
				<a href="SystemWideScriptingWithFScript-index-ja.html">
				  F-Script で Mac の様々なアプリケーションを操作する
				</a>
				<a href="http://www.fscript.org/documentation/SystemWideScriptingWithFScript/index.htm">
				  ［原文］
				</a>
			  </li>
			  <li>
				<a href="EmbeddingFScriptIntoCocoa-index-ja.html">
				  Cocoa アプリケーションに F-Script を埋め込む
				</a>
				<a href="http://www.fscript.org/documentation/EmbeddingFScriptIntoCocoa/index.htm">
				  ［原文］
				</a>
			  </li>
			  <li>
				<a href="AccessingMacOSXFrameworksWithFScript-index-ja.html">
				  F-Script で Mac OS X のフレームワーク群にアクセスする
				</a>
				<a href="http://www.fscript.org/documentation/AccessingMacOSXFrameworksWithFScript/index.htm">
				  ［原文］
				</a>
			  </li>
			</ol>
			
			<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			  その他
			  <!-- Miscellaneous -->
			</b><br>
			<ol>
			  <li>
				<a href="GoogleChartAPIFunWithCocoaAndFScript-index-ja.html">
				  Cocoa と F-Script で Google Chart API をいじってみよう
				  </a>
				  <a href="http://www.fscript.org/documentation/GoogleChartAPIFunWithCocoaAndFScript/index.htm">
				  ［原文］
				  </a>
			  </li>
			  <li>
				<a href="TheGameOfReverseInFScript-index-ja.html">
				  F-Script 版 Reverse ゲーム
				</a>
				<a href="http://www.fscript.org/documentation/TheGameOfReverseInFScript/index.htm">
				  ［原文］
				</a>
			  </li>
			</ol>
		  </td>
		</tr>
	</tbody></table>

    <h2>はじめに</h2>
    <!-- Introduction -->
    <p>
      Cocoa が 高度に動的で、再定義可能であり、しかも、オープンなオブジェクトモデルの上に構築されているという事実について、Objective-C に感謝しよう。
      とりわけ、オブジェクトグラフエディタ、ランタイムモニタリングツール、オブジェクトブラウザ、等々その他数多くの Cocoa ランタイムの能力を利用するプログラムの作成が可能なのは、この事実のお陰なのである。
      Cocoa のオープン性の一つの重要な応用は、スクリプティング言語と Cocoa の統合だが、これは非常に役に立つ。
      というのは、この統合によって、Cocoa を対話的に使うことが可能になり、複数の Cocoa コンポーネントを容易に結合して使うことが可能になるからだ。
      <!--
	  Thanks to Objective-C, Cocoa is built upon a highly dynamic, reflexive and open object model.
	  Amon1g other things, this makes it possible to build visual object graph editors, run-time monitoring tools,
	  object browsers and numerous other programs making use of the capabilities of the Cocoa run-time.
	  One important application of Cocoa's openness is its integration with scripting languages.
	  This is very useful because it allows for interactive use and easy gluing of Cocoa components.
	-->
    </p>
    <p>
      この記事では、Cocoa スクリプティングとはどのようなものか、その感触をお伝えしたい。また、どんなレベルの統合が期待できるのかについても示したい。
      我々は、Cocoa 専用のオープンソーススクリプト言語 F-Script を使って、小さなグラフィカルアプリケーションを創る。
      グラフィカルユーザーインタフェースを作る為の Cocoa オブジェクトフレームワークである Application Kit を使って、F-Script で直接プログラムしていくのだ。
      この種のアプリケーションはインタフェースビルダーを使って作ることもできるが、
      この記事では、Cocoa スクリプティングを解説する為に、Application Kit をプログラム的に使っていくことに注意されたい。
    <!--
      In this article I want to give you a taste of Cocoa scripting, and to show you the level of integration that you can expect.
      We will use F-Script, an open source scripting language for Cocoa, to build a little graphical application.
      Using F-Script, we will directly program against the Application Kit, which is the Cocoa object framework for graphical user interfaces.
      Note that one can build this kind of application using Interface Builder,
      but in this article we will use the Application Kit programmatically, in order to illustrate Cocoa scripting.
	-->
    </p>
    <p>
      F-Script は <a href="http://www.fscript.org/">http://www.fscript.org</a> からダウンロードできる。
    <!--
      F-Script can be downloaded at <a href="http://www.fscript.org/">http://www.fscript.org</a>.
	-->
    </p>
    <p>
      注記：この記事は、O'Reilly MacDevcenter の記事 <a href="http://www.oreillynet.com/pub/a/mac/2001/11/30/scripting_fscript.html"> <i>Scripting Cocoa with F-Script </i> </a>
      の改訂版である。
    <!--
      Note: This article is an updated version of <i>Scripting Cocoa with F-Script</i>, which is published on the O'Reilly MacDevcenter
      <a href="http://www.oreillynet.com/pub/a/mac/2001/11/30/scripting_fscript.html">here</a>.
	-->
    </p>
    <h2>更にもう一つの カレンシーコンバータ</h2>
    <!--
      Yet another currency converter
	-->
    <p>
      これから作るアプリケーションは、
      <a href="https://developer.apple.com/jp/documentation/Cocoa/Conceptual/ObjCTutorial/01Introduction/chapter_1_section_1.html">アップル チュートリアル</a>
      にあるものとそっくりな「カレンシーコンバータ」（通貨換算器）だ。
    <!--
      これから作るアプリケーションは、<a href="http://developer.apple.com/documentation/Cocoa/Conceptual/ObjCTutorial/index.html">アップル チュートリアル</a>
      にあるものにそっくりな「カレンシーコンバータ」（通貨換算器）だ。
	-->
      
    <!--
      Our application is a "currency converter" similar to the one found in
      <a href="http://developer.apple.com/documentation/Cocoa/Conceptual/ObjCTutorial/index.html">Apple tutorials</a>.
	-->
    </p>
    <img src="ScriptingCocoaWithFScript-index-ja_files/fig1.png">
    <p class="legend">
       F-Script と Cocoa を使って、これから作る カレンシーコンバータ
    <!--
      The currency converter we will build using F-Script and Cocoa.
	-->
    </p>
    <!--
	-->
    <h2>F-Script</h2>
     <!-- F-Script -->
    <p>
      F-Script は、Smalltalk に似た構文とコンセプトを持つ、純粋にオブジェクト指向のスクリプト言語である。
      読者は、<b>FScript.app</b> アプリケーションが提供する対話的なシェルに命令を入力することによって F-Script と対話することができる。
      <!--
	  読者は、命令をタイプして使える対話的なシェルを提供する <b>FScript.app</b> アプリケーションを通して、F-Script と対話することができる。
	-->
      <!--
	  F-Script is a pure object-oriented scripting language with Smalltalk-like syntax and concepts.
	  You can interact with F-Script through the <b>FScript.app</b> application, which gives you an interactive shell into which you can type instructions.
	-->
    </p>
    <p>
      F-Script 構文に関する幾つかのポイント：
      <!--
      Some pointers on the F-Script syntax:
	-->
    </p><ul>
      <li>
	命令と命令は、ドットで区切る
      <!--
	  <li>Instructions are separated by a dot.</li><br>
	-->
      </li><br>
      <li>
	<code>
	  :=
	</code>
	は 代入を意味する
	<!--
	denotes an assignment.
	-->
      </li><br>
      <li>
	文字列は 単一クオートで括る:
	<!--
	    Strings use simple quotes:
	  -->
	<code>
	  'A string'
	</code>
      </li><br>
      <li>
	コメントは ダブルクオートで括る：
	<!--
	    Comments use double quotes:
	  -->
	<code>
	  "A comment"
	</code>
      </li><br>
      <li>
	<code>(125&lt;&gt;513 extent:383&lt;&gt;175)</code> は四角形を意味する。これは Objective-C における <code>NSMakeRect(125, 513, 383, 175)</code> と等価である。
	<!--
	    <code>(125&lt;&gt;513 extent:383&lt;&gt;175)</code> denotes a rectangle. It is equivalent to <code>NSMakeRect(125, 513, 383, 175)</code> in Objective-C.
	-->
      </li>
    </ul>
    <p>
    </p>
    <h2>
      カレンシーコンバータ スクリプト：第一版
      <!--
	  The currency converter script: first version
	-->
    </h2>
    <p>
      以下のスクリプトを F-Script シェルに入力するには、単にコピー／ペーストしても良いが、少しずつ命令を入力していってもよい：
      そうすれば、このカレンシーコンバータのユーザーインタフェースが、少しずつ姿を現してくる様子を見ることができるだろう。
      もちろん、スクリプト中のさまざまな引数の値を変更してみたり、命令をいくつか省いてみたりして、何が起こるかを見てみることもできる。
      カレンシーコンバータが完成した後に、各オブジェクトを対話的に操作することさえできるのだ。
      <!--
	  The following script can be entered into the F-Script shell using a simple copy/paste.
	  You can also enter the intructions step by step: you will then see the currency converter interface appearing bit by bit.
	  Of course, you can change the values of arguments used in the script or omit some instructions in order to see what happens.
	  You can even interact with the objects after you have built the currency converter.
      -->
    </p>
    
<!-- ------------------------------------------------------------------------------------------------------------------------ -->
<pre class="codebox"><code><span class="comment">"F-SCRIPT CURRENCY CONVERTER (VERSION 1)"</span>

<span class="comment">"ウィンドウを初期化して、必要な種設定を行う"</span>
<span class="identifier">window</span> := <span class="identifier">NSWindow</span> <span class="selector">alloc</span> <span class="selector">initWithContentRect:</span>(<span class="literal">125</span><span class="selector">&lt;&gt;</span><span class="literal">513</span> <span class="selector">extent:</span><span class="literal">383</span><span class="selector">&lt;&gt;</span><span class="literal">175</span>)
                                   <span class="selector">styleMask:</span><span class="identifier">NSTitledWindowMask</span> <span class="selector">+</span>
				             <span class="identifier">NSClosableWindowMask</span> <span class="selector">+</span>
					     <span class="identifier">NSMiniaturizableWindowMask</span>
                                     <span class="selector">backing:</span><span class="identifier">NSBackingStoreBuffered</span>
                                       <span class="selector">defer:</span><span class="literal">NO</span>.

<span class="comment">"ウィンドウを画面に表示する"</span>
<span class="identifier">window</span> <span class="selector">orderFront:</span><span class="literal">nil</span>.

<span class="comment">"ウィンドウのタイトルを設定する"</span>
<span class="identifier">window</span> <span class="selector">setTitle:</span><span class="string">'Currency Converter'</span>.

<span class="comment">"NSForm オブジェクトをインスタンス化する"</span>
<span class="identifier">form</span> := <span class="identifier">NSForm</span> <span class="selector">alloc</span> <span class="selector">initWithFrame:</span>(<span class="literal">15</span><span class="selector">&lt;&gt;</span><span class="literal">70</span> <span class="selector">extent:</span><span class="literal">348</span><span class="selector">&lt;&gt;</span><span class="literal">85</span>).

<span class="comment">"フォームをウィンドウ内に配置する"</span>
<span class="identifier">window</span> <span class="selector">contentView</span> <span class="selector">addSubview:</span><span class="identifier">form</span>.

<span class="comment">"フォームに各種設定を行う"</span>
<span class="identifier">form</span> <span class="selector">addEntry:</span><span class="string">'Exchange Rate per $1'</span>.
<span class="identifier">form</span> <span class="selector">addEntry:</span><span class="string">'Dollars to Convert'</span>.
<span class="identifier">form</span> <span class="selector">addEntry:</span><span class="string">'Amount in Other Currency'</span>.
<span class="identifier">form</span> <span class="selector">setInterlineSpacing:</span><span class="literal">9</span>.
<span class="identifier">form</span> <span class="selector">setAutosizesCells:</span><span class="literal">YES</span>.

<span class="comment">"装飾線をインスタンス化してウィンドウ内に配置する"</span>
<span class="identifier">line</span> := <span class="identifier">NSBox</span> <span class="selector">alloc</span> <span class="selector">initWithFrame:</span>(<span class="literal">15</span><span class="selector">&lt;&gt;</span><span class="literal">59</span> <span class="selector">extent:</span><span class="literal">353</span><span class="selector">&lt;&gt;</span><span class="literal">2</span>).
<span class="identifier">window</span> <span class="selector">contentView</span> <span class="selector">addSubview:</span><span class="identifier">line</span>.

<span class="comment">"ボタンをインスタンス化してウィンドウ内に配置し、ボタンに各種設定を行う"</span>
<span class="identifier">button</span> := <span class="identifier">NSButton</span> <span class="selector">alloc</span> <span class="selector">initWithFrame:</span>(<span class="literal">247</span><span class="selector">&lt;&gt;</span><span class="literal">15</span> <span class="selector">extent:</span><span class="literal">90</span><span class="selector">&lt;&gt;</span><span class="literal">30</span>).
<span class="identifier">window</span> <span class="selector">contentView</span> <span class="selector">addSubview:</span><span class="identifier">button</span>.
<span class="identifier">button</span> <span class="selector">setBezelStyle:</span><span class="identifier">NSRoundedBezelStyle</span>.
<span class="identifier">button</span> <span class="selector">setTitle:</span><span class="string">'Convert'</span>.
<span class="identifier">button</span> <span class="selector">setKeyEquivalent:</span><span class="string">'\r'</span>.

<span class="comment">"通貨換算の計算を行うスクリプトを生成する"</span>
<span class="identifier">conversionScript</span> := [
        (<span class="identifier">form</span> <span class="selector">cellAtIndex:</span><span class="literal">2</span>) <span class="selector">setStringValue:</span>(<span class="identifier">form</span> <span class="selector">cellAtIndex:</span><span class="literal">0</span>) <span class="selector">floatValue</span> <span class="selector">*</span> (<span class="identifier">form</span> <span class="selector">cellAtIndex:</span><span class="literal">1</span>) <span class="selector">floatValue</span>
].

<span class="comment">"そのスクリプトをフォームのターゲットにする。
ユーザーがリターンキーを押すと、スクリプトが評価される"</span>
<span class="identifier">form</span> <span class="selector">setTarget:</span><span class="identifier">conversionScript</span>.
<span class="identifier">form</span> <span class="selector">setAction:</span><span class="literal">#value</span>.

<span class="comment">"そのスクリプトをボタンのターゲットにする。
ユーザーがボタンを押すと、スクリプトが評価される"</span>
<span class="identifier">button</span> <span class="selector">setTarget:</span><span class="identifier">conversionScript</span>.
<span class="identifier">button</span> <span class="selector">setAction:</span><span class="literal">#value</span>.
</code></pre>
<!-- ------------------------------------------------------------------------------------------------------------------------ -->
    <p>
      いくつかの興味深い事柄を、以下に書き留めておこう：
      <!--
	  We note several interesting things straight away:
	-->
    </p>
    <ul>
      <li>オブジェクトへのメッセージ送信の構文は、Objective-C の構文によく似ているが、メッセージ送信の初めと終わりの印である
	<code>[</code> と <code>]</code> は使わない。
	この類似は驚くべきことではない。というのは、Objective-C のメッセージ送信の構文は、Smalltalk から借りてきたものだからだ。
	<!--
	    <li>The syntax for sending messages to objects is similar to the Objective-C syntax, except that we don't use
	      <code>[</code>and<code>]</code>
	      to mark the beginning and end of a message send.
	      This similarity doesn't come as a surprise because Objective-C syntax for message sending is borrowed from Smalltalk.
	      -->
	</li><br>
      <li>Cocoa のクラスをコードの中で直接参照している：
	<code>NSWindow</code>、<code>NSForm</code>、<code>NSButton</code> そして、<code>NSBox</code> は、Cocoa のクラスである。
	<!--
	    <li>We directly reference the Cocoa classes in the code:
	      <code>NSWindow</code>,<code>NSForm</code>,<code>NSButton</code>, and <code>NSBox</code>are Cocoa classes.
	      -->
      </li><br>
      <li>Cocoa 定数も直接参照している：
	<code>NSTitledWindowMask</code>、<code>NSClosableWindowMask</code> や <code>NSRoundedBezelStyle</code> は、Cocoa で定義されているシンボル名である。
	<!--
	    <li>We directly reference Cocoa constants: constants such as
	      <code>NSTitledWindowMask</code>,<code>NSClosableWindowMask</code>, or <code>NSRoundedBezelStyle</code> are symbolic names defined by Cocoa.
	      -->
      </li><br>
      <li>Cocoa API を直接使っている：
	<code>alloc</code>、<code>initWithFrame:</code>、<code>setTitle:</code> 等々のようなメソッドは、Cocoa フレームワークの一部である。
	<!--
	    <li>We directly use the Cocoa API.
	      Methods such as <code>alloc</code>,<code>initWithFrame:</code>,<code>setTitle:</code>,
	      and so on are part of the Cocoa frameworks.
	      -->
      </li><br>
      <li>Cocoa のメソッドに、引数として F-Script オブジェクトを渡すことができる。そして逆に、その呼び出し結果から、Cocoa オブジェクトを入手して、更に F-Script でそれらを使うことができる。
	ご承知のように、この種の統合を提供するには、しばしば何かしら取り扱いの難しいブリッジ技術を使う必要が出てくるものだ。しかし F-Script の場合、この点に関してはずっと単純だ。
	というのは、ブリッジすべきものが何もないからだ：F-Script のオブジェクトモデルは Cocoa そのものなのである。
	<!--
	    We can pass F-Script objects as arguments to Cocoa methods. 
	    Alternatively, we can get Cocoa objects from these calls and further use them from F-Script.
	    As you may know, providing this kind of integration often requires the use of somewhat delicate bridging techniques.
	    With F-Script, things are much simpler in this respect because there is nothing to bridge:
	    The F-Script object model is the Cocoa object model.
	      -->
      </li><br>
    </ul>
    <p>
      実際の通貨換算は、以下の命令を使って生成されるオブジェクトによって計算される：
      <!--
	  The actual currency conversion is computed by an object created using the following instruction:
	-->
      </p>
<!-- ------------------------------------------------------------------------------------------------------------------------ -->
<p></p><pre class="codebox"><code><span class="identifier">conversionScript</span> := [
	(<span class="identifier">form</span> <span class="selector">cellAtIndex:</span>2) <span class="selector">setStringValue:</span>(<span class="identifier">form</span> <span class="selector">cellAtIndex:</span><span class="literal">0</span>) <span class="selector">floatValue</span> <span class="selector">*</span> (<span class="identifier">form</span> <span class="selector">cellAtIndex:</span><span class="literal">1</span>) <span class="selector">floatValue</span>
].
</code></pre>                        
<!-- ------------------------------------------------------------------------------------------------------------------------ -->
                        
    <p>
       <code>[...]</code> という記法は、後で実行可能なひと纏まりのコードを表す Block クラスのオブジェクトを生成する。
       （Block は F-Script framework で提供される Objective-C クラスである）
       上のブロックの中では、ユーザーインタフェースオブジェクトの持つフィールドの値を取り出して、計算（単純なかけ算を含む）を実行して、ある UI 要素に、その結果を置いているだけである。
      <!--
	  The <code>[...]</code> notation creates an object of class Block which represents a block of code that can be executed later
	  (Block is an Objective-C class provided by the F-Script framework).
	  In our block, we simply get the values of the fields in the user interface objects,
	  perform the computation (simply involves multiplication) and put the result in a UI element.
	-->
    </p>
    
    <p>
       このコードでは更に、上のブロックが、フォームとボタンオブジェクトのターゲットになっている。
       こうして、ユーザーが、リターンキーを押すか、ボタンをクリックすると、このブロックが評価されることになる。
      <!--
	 Further on in the code, our block object becomes the target of the form and button objects.
	 Thus, it is evaluated when the user hits Return or clicks on the button.
       -->
    </p>
    <h2>
      カレンシーコンバータ スクリプト：第二版
    <!--
	<h2>
	  The currency converter script: second version
	</h2>
	-->
    </h2>
    <p>
      カレンシーコンバータの第二版を以下に示そう。
      このスクリプトは、以前のものより短くなっているが、それは、第一版では単純化の為に使うのを避けた F-Script の賢い機能をいくつか使っているからだ。
      また、（コード自体に語らせることにして）いくつかのコメントを削除して、ほんの少しだがプログラムを再編成してもいる：
      今度は、事前にユーザーインタフェースを全て作り上げ、必要な設定も全て済ませてから、画面に表示させている。
      <!--
	  Below is the second version of the currency converter.
	  This script is shorter because we use some neat F-Script features that we avoided in the first version for simplicity's sake.
	  We also removed some comments (the code speaks for itself) and reorganized the program a little bit: 
	  the interface is now entirely constructed and configured before being put on screen.
	-->
    </p>

<!-- ------------------------------------------------------------------------------------------------------------------------ -->
<pre class="codebox"><code><span class="comment">"F-SCRIPT CURRENCY CONVERTER (VERSION 2)"</span>

<span class="comment">"ウィンドウを初期化して、必要な設定を行う"</span>
<span class="identifier">window</span> := <span class="identifier">NSWindow</span> <span class="selector">alloc</span> <span class="selector">initWithContentRect:</span>(<span class="literal">125</span><span class="selector">&lt;&gt;</span><span class="literal">513</span> <span class="selector">extent:</span><span class="literal">383</span><span class="selector">&lt;&gt;</span><span class="literal">175</span>)
                                   <span class="selector">styleMask:</span><span class="identifier">NSTitledWindowMask</span> <span class="selector">+</span>
				             <span class="identifier">NSClosableWindowMask</span> <span class="selector">+</span>
					     <span class="identifier">NSMiniaturizableWindowMask</span>
                                     <span class="selector">backing:</span><span class="identifier">NSBackingStoreBuffered</span>
                                       <span class="selector">defer:</span><span class="literal">NO</span>.

<span class="comment">"通貨換算の計算を行うスクリプトを生成する"</span>
<span class="identifier">conversionScript</span> := [
        (<span class="identifier">form</span> <span class="selector">cellAtIndex:</span><span class="literal">2</span>) <span class="selector">setStringValue:</span>(<span class="identifier">form</span> <span class="selector">cellAtIndex:</span><span class="literal">0</span>) <span class="selector">floatValue</span> <span class="selector">*</span> (<span class="identifier">form</span> <span class="selector">cellAtIndex:</span><span class="literal">1</span>) <span class="selector">floatValue</span>
].

<span class="comment">"フォームをインスタンス化して、構成を組上げる"</span>
<span class="identifier">form</span> := <span class="identifier">NSForm</span> <span class="selector">alloc</span> <span class="selector">initWithFrame:</span>(<span class="literal">15</span><span class="selector">&lt;&gt;</span><span class="literal">70</span> <span class="selector">extent:</span><span class="literal">348</span><span class="selector">&lt;&gt;</span><span class="literal">85</span>).
<span class="identifier">form</span> <span class="selector">addEntry:@</span>{<span class="string">'Exchange Rate per $1'</span>, <span class="string">'Dollars to Convert'</span>, <span class="string">'Amount in Other Currency'</span>}.
<span class="identifier">form</span> <span class="selector">setInterlineSpacing:</span><span class="literal">9</span>; <span class="selector">setAutosizesCells:</span><span class="literal">YES</span>; <span class="selector">setTarget:</span><span class="identifier">conversionScript</span>; <span class="selector">setAction:</span><span class="literal">#value</span>.

<span class="comment">"ボタンをインスタンス化して、構成を組上げる"</span>
<span class="identifier">button</span> := <span class="identifier">NSButton</span> <span class="selector">alloc</span> <span class="selector">initWithFrame:</span>(<span class="literal">247</span><span class="selector">&lt;&gt;</span><span class="literal">15</span> <span class="selector">extent:</span><span class="literal">90</span><span class="selector">&lt;&gt;</span><span class="literal">30</span>).
<span class="identifier">button</span> <span class="selector">setBezelStyle:</span><span class="identifier">NSRoundedBezelStyle</span>; <span class="selector">setTitle:</span><span class="string">'Convert'</span>; <span class="selector">setTarget:</span><span class="identifier">conversionScript</span>;
       <span class="selector">setAction:</span><span class="literal">#value</span>; <span class="selector">setKeyEquivalent:</span><span class="string">'\r'</span>.

<span class="comment">"装飾線をインスタンス化して、構成を組上げる"</span>
<span class="identifier">line</span> := <span class="identifier">NSBox</span> <span class="selector">alloc</span> <span class="selector">initWithFrame:</span>(<span class="literal">15</span><span class="selector">&lt;&gt;</span><span class="literal">59</span> <span class="selector">extent:</span><span class="literal">353</span><span class="selector">&lt;&gt;</span><span class="literal">2</span>).
  
<span class="comment">"各コンポーネントをウィンドウの中に配置して、そのウィンドウを画面に表示する"</span>
<span class="identifier">window</span> <span class="selector">contentView</span> <span class="selector">addSubview:@</span>{<span class="identifier">form</span>, <span class="identifier">button</span>, <span class="identifier">line</span>}. 
<span class="identifier">window</span> <span class="selector">setTitle:</span><span class="string">'Currency Converter'</span>; <span class="selector">orderFront:</span><span class="literal">nil</span>.
</code></pre>
<!-- ------------------------------------------------------------------------------------------------------------------------ -->

<p>
  このバージョンで新たに使ったものの一つが、メッセージを続けて送る為の「;」記法である。
  この記法を使うと、毎回レシーバを指定し直さなくとも、単一のレシーバに対して、いくつもメッセージを送ることができる。
  <!--
      One of the new things we use in this version is the "<code>;</code>" notation for cascading messages.
      This notation enables us to send several messages to a single receiver without having to re-specify the receiver each time.
    -->
</p>

<p>
  もう一つ興味深いのは、次の命令だ：
<!-- Another interesting thing is the instruction: -->
</p>

<!-- ------------------------------------------------------------------------------------------------------------------------ -->
<pre class="codebox"><code><span class="identifier">form</span> <span class="selector">addEntry:@</span>{<span class="string">'Exchange Rate per $1'</span>, <span class="string">'Dollars to Convert'</span>, <span class="string">'Amount in Other Currency'</span>}.</code></pre>
<!-- ------------------------------------------------------------------------------------------------------------------------ -->

<p>
  F-Script の革新的な特徴の一つは、特にオブジェクトのコレクションを扱える様には設計されていないメソッドを使ったとしても、オブジェクトの集まりの全体を一度に操作できることだ。
  （実際、F-Script は、Cocoa オブジェクトに対して直接使える完全なオブジェクトクエリ言語を提供している。）
  この命令が、まさにその場合で、ここでは、フォームに対して、入力項目のリスト全体を一度に追加している。
  ここでは、潜在的に複雑な一群のメッセージ送信を指定できる様にしてくれる「メッセージングパターン」記法（「<code>@</code>」で表される）を使っている。
  メッセージングパターンは、ふつう、一つまたは複数のオブジェクトコレクションを含んでいる。
  この例では、「<code>{</code>」と「<code>}</code>」で表される文字列配列を使っている。この命令を実行すると、それをきっかけに、以下の三つのメッセージ送信が生成される：
  <!--
      One of the innovative features of F-Script is that it allows us to manipulate entire groups of objects at once,
      even with methods that have not been specifically designed to support objects collections 
      (actually, F-Script provides a full object query language, directly usable on Cocoa objects).
      This is the case in this instruction, where we add a whole list of entries to the form at once.
      We use the "messaging pattern" notation (denoted by "<code>@</code>") that allows us to specify potentially complex groups of message sends.
      A messaging pattern generally involves single or multiple collections of objects:
      in our example, we use an array of string objects, denoted by "<code>{</code>" and "<code>}</code>".
      At run-time, the instruction will trigger the generation of these three message sends:
    -->
</p>

<ol style="margin: 12px 60px 12px 60px;">
<li><code><span class="identifier">form</span> <span class="selector">addEntry:</span><span class="string">'Exchange Rate per $1'</span></code></li>
<li><code><span class="identifier">form</span> <span class="selector">addEntry:</span><span class="string">'Dollars to Convert'</span></code></li>
<li><code><span class="identifier">form</span> <span class="selector">addEntry:</span><span class="string">'Amount in Other Currency'</span></code></li>
</ol>

<p>
  次の命令でもまた、同じパターンが使われており、ここでは、複数のビューを、まとめて一度にウィンドウに配置している。
  <!--
      The same pattern is also used in the following instruction, where we put a whole set of views into the window at once:
    -->
</p>

<!-- ------------------------------------------------------------------------------------------------------------------------ -->
<pre class="codebox"><code><span class="identifier">window</span> <span class="selector">contentView</span> <span class="selector">addSubview:@</span>{<span class="identifier">form</span>, <span class="identifier">button</span>, <span class="identifier">line</span>}.
</code></pre>
<!-- ------------------------------------------------------------------------------------------------------------------------ -->

<p>
  これまでの例では、比較的単純なパターンを使っていたが、F-Script は、更に複雑なメッセージングパターンを表現できる様にする為の構文も提供している。
  <!--
      In these examples, we use a relatively simple pattern.
      F-Script provides a syntax that makes it possible to express more complex messaging patterns. <br>
      All the specific concepts of F-Script, like messaging patterns, can be used when scripting Cocoa.
    -->
</p>

<p>
  F-Script は、Objective-C の自動ガベージコレクションと共に使えるよう設計されている。
  もしF-Script を、参照カウントモードで動かす場合は、生成した様々な Cocoa オブジェクトが使われなくなったら破壊されることを保証する為に、いくつかの付加的な呼び出しを追加しなければならない。
  明確に言えば、フォームを生成する式、ボタンを生成する式、線を生成する式に対して、<code>autorelease</code> メッセージ送信を追加しなければならない。
  そうすると、例えばフォームを生成する式は、こうなる：
  <!--
      Our script is designed for use with Objective-C automatic garbage collection.
      If we run F-Script in reference counting mode
      we should add a few additional calls to ensure that the various Cocoa objects we create will be destroyed when no longer in use.
      Specifically, we should add <code>autorelease</code> message sends to the expression that create the form,
      the expression that create the button and the expression that create the line.
      So, for instance, the expression that create the form becomes:
    -->
</p>

<!-- ------------------------------------------------------------------------------------------------------------------------ -->
<pre class="codebox"><code><span class="identifier">form</span> := (<span class="identifier">NSForm</span> <span class="selector">alloc</span> <span class="selector">initWithFrame:</span>(<span class="literal">15</span><span class="selector">&lt;&gt;</span><span class="literal">70</span> <span class="selector">extent:</span><span class="literal">348</span><span class="selector">&lt;&gt;</span><span class="literal">85</span>)) <span class="selector">autorelease</span>.
</code></pre>
<!-- ------------------------------------------------------------------------------------------------------------------------ -->

<p>
  参照カウントモードでは、オブジェクトをスクリプトのグローバル変数やローカル変数に代入する時に、F-Script が自動的に、それを保持し、その変数に別のオブジェクトが再代入された時に、
  それを解放してくれる。だから、この場合は、明示的に <code>retain</code> 呼び出しを追加する必要は無い。
  <!--
      In reference counting mode, when we assign an object to a script's global or local variable,
      F-Script automatically retains it, releasing it when we re-assign another object to the variable.
      Thus, in this particular script, we don't need to add any explicit <code>retain</code> invocations.  
    -->
</p>

<h2>
  カレンシーコンバータ スクリプト：第三版
  <!-- The currency converter script: third version -->
</h2>

<p>
  現状のままでは、我々のスクリプトには、全くモジュラー性がない：
  それは、実行する為に F-Script コンソールにペーストした、グローバル変数を使った命令の寄せ集めに過ぎない。
  次のバージョンでは、モジュラー性を導入する：
  <!--
      As it stands, our script is not very modular:
      it's just a set of instructions, using global variables,
      that we paste into the F-Script console in order to execute them.
      The following version introduces modularity:
      -->
</p>
<ul>
  <li>このバージョンでは、スクリプト自体が、一つのオブジェクトになる。</li>
  <li>トップレベルの環境を汚染しない様に、今度は、グローバル変数ではなく、ローカル変数を使用する。</li>
  <li>このバージョンのスクリプトは、ウィンドウのタイトル文字列を引数に取る。</li>
  <!--
  <li>
    Our script will become itself an object.
  </li>
  <li>
    It will now use local variables instead of global variables, in order to not pollute the top-level environment.
  </li>
  <li>
    It will take the window's title as argument.
  </li>
  -->
</ul>


<pre class="codebox"><code><span class="comment">"F-SCRIPT CURRENCY CONVERTER (VERSION 3)"</span>
<span class="identifier">converter</span> := [:<span class="identifier">title</span> | |<span class="identifier">window</span> <span class="identifier">conversionScript</span> <span class="identifier">form</span> <span class="identifier">button</span> <span class="identifier">line</span>|

    <span class="comment">"ウィンドウを初期化して、構成を組上げる"</span>
    <span class="identifier">window</span> := <span class="identifier">NSWindow</span> <span class="selector">alloc</span> <span class="selector">initWithContentRect:</span>(<span class="literal">125</span><span class="selector">&lt;&gt;</span><span class="literal">513</span> <span class="selector">extent:</span><span class="literal">383</span><span class="selector">&lt;&gt;</span><span class="literal">175</span>)
                                       <span class="selector">styleMask:</span><span class="identifier">NSTitledWindowMask</span> <span class="selector">+</span>
				                 <span class="identifier">NSClosableWindowMask</span> <span class="selector">+</span>
					         <span class="identifier">NSMiniaturizableWindowMask</span>
                                         <span class="selector">backing:</span><span class="identifier">NSBackingStoreBuffered</span>
                                           <span class="selector">defer:</span><span class="literal">NO</span>.

    <span class="comment">"通貨換算の計算を行うスクリプトを生成する"</span>
    <span class="identifier">conversionScript</span> := [
        (<span class="identifier">form</span> <span class="selector">cellAtIndex:</span><span class="literal">2</span>) <span class="selector">setStringValue:</span>(<span class="identifier">form</span> <span class="selector">cellAtIndex:</span><span class="literal">0</span>) <span class="selector">floatValue</span> <span class="selector">*</span> (<span class="identifier">form</span> <span class="selector">cellAtIndex:</span><span class="literal">1</span>) <span class="selector">floatValue</span>
    ].
  
    <span class="comment">"フォームをインスタンス化して、構成を組上げる"</span>
    <span class="identifier">form</span> := <span class="identifier">NSForm</span> <span class="selector">alloc</span> <span class="selector">initWithFrame:</span>(<span class="literal">15</span><span class="selector">&lt;&gt;</span><span class="literal">70</span> <span class="selector">extent:</span><span class="literal">348</span><span class="selector">&lt;&gt;</span><span class="literal">85</span>).
    <span class="identifier">form</span> <span class="selector">addEntry:@</span>{<span class="string">'Exchange Rate per $1'</span>, <span class="string">'Dollars to Convert'</span>, <span class="string">'Amount in Other Currency'</span>}.
    <span class="identifier">form</span> <span class="selector">setInterlineSpacing:</span><span class="literal">9</span>; <span class="selector">setAutosizesCells:</span><span class="literal">YES</span>; <span class="selector">setTarget:</span><span class="identifier">conversionScript</span>; <span class="selector">setAction:</span><span class="literal">#value</span>.

    <span class="comment">"ボタンをインスタンス化して、構成を組上げる"</span>
    <span class="identifier">button</span> := <span class="identifier">NSButton</span> <span class="selector">alloc</span> <span class="selector">initWithFrame:</span>(<span class="literal">247</span><span class="selector">&lt;&gt;</span><span class="literal">15</span> <span class="selector">extent:</span><span class="literal">90</span><span class="selector">&lt;&gt;</span><span class="literal">30</span>).
    <span class="identifier">button</span> <span class="selector">setBezelStyle:</span><span class="identifier">NSRoundedBezelStyle</span>; <span class="selector">setTitle:</span><span class="string">'Convert'</span>; <span class="selector">setTarget:</span><span class="identifier">conversionScript</span>;
           <span class="selector">setAction:</span><span class="literal">#value</span>; <span class="selector">setKeyEquivalent:</span><span class="string">'\r'</span>.

    <span class="comment">"装飾線をインスタンス化して、構成を組上げる"</span>
    <span class="identifier">line</span> := <span class="identifier">NSBox</span> <span class="selector">alloc</span> <span class="selector">initWithFrame:</span>(<span class="literal">15</span><span class="selector">&lt;&gt;</span><span class="literal">59</span> <span class="selector">extent:</span><span class="literal">353</span><span class="selector">&lt;&gt;</span><span class="literal">2</span>).
  
    <span class="comment">"各コンポーネントをウィンドウの中に配置し、そのウィンドウを画面に表示する"</span>
    <span class="identifier">window</span> <span class="selector">contentView</span> <span class="selector">addSubview:@</span>{<span class="identifier">form</span>, <span class="identifier">button</span>, <span class="identifier">line</span>}. 
    <span class="identifier">window</span> <span class="selector">setTitle:</span><span class="string">'Currency Converter'</span>; <span class="selector">orderFront:</span><span class="literal">nil</span>.
]
</code></pre>


<p>
  今回のバージョンでは、F-Script インタープリタにブロックオブジェクトを生成させる為に、命令群を <code>[</code> と <code>]</code> の間に置く。
  また、スクリプトの最初の行で、引数とローカル変数を宣言する。最後に、我々のスクリプトを表すこのブロックオブジェクトに、「converter」という名前を付ける。
  ブロックは、自分の外部の変数にアクセスできるばかりでなく、任意の数の引数を取ることができ、任意の数のローカル変数を持つことができる。
  <!--
      In this version, we put the instructions between <code>[</code> and <code>]</code> in order to make the F-Script interpreter generates a block object.
      We also declare, on the first line of the script, the argument and the local variables.
      Finally, we give the name "converter" to the block object that represents our script.
      
      A block can take an arbitrary number of arguments and can have an arbitrary number of local variables,
      as well as having access to variables of its enclosing environment. 
    -->
</p>

<p>
  さあ、今度は、必要な引数を忘れずに与えて「value」メッセージを送信すれば、我々のスクリプトを起動できるのだ。
  例えば：
  <!--
      We can now invoke our script by sending it a "value" message, without forgetting to provide the required argument. For instance:
    -->
</p>

<pre class="codebox"><code><span class="identifier">converter</span> <span class="selector">value:</span><span class="string">'My Great Converter'</span>
</code></pre>

<p>
  これを起動する度に、新しく、全機能を備えたカレンシーコンバータが創られて、画面に表示される。
  <!--
      Each time we invoke it, a new, fully functional currency converter is created and displayed on screen.
    -->
</p>

<p>
  我々のスクリプトは、今やブロックオブジェクトなのであるから、それを他のあらゆるオブジェクトと同じ様に扱うことができる：
  コレクションの要素にもできるし、引数として、メソッドに渡すこともできるし、ディスク上にアーカイブすることもできる、等々。
  特にブロックを扱うために備えられたツールがいくつかあるが、グラフィカルコードエディタは、その一つだ。
  このブロックに、<code>inspect</code> メッセージを送れば、それを開くことができる。
  <!--
      Since our script is now a block object, we can manipulate it like any other object:
      put it in a collection, pass it as an argument to methods, archive it on disk etc.
      There are also several facilities specifically related to blocks, including a graphical code editor.
      We can open it by sending an <code>inspect</code> message to our block.
    -->
</p>

<pre class="codebox"><code><span class="identifier">converter</span> <span class="selector">inspect</span>
</code></pre>

<p>
  最後になるが、F-Script は、どんな Cocoa アプリケーションにでも埋め込めるフレームワークの形式でも提供されているので、
  標準的な Mac OS X アプリケーションの中に、読者のスクリプトを簡単に埋め込むことができる。
  <!--
      Finally, since F-Script comes in the form of a framework ready to be embedded into any Cocoa application,
      it is easy to place our script in a standard Mac OS X executable.
    -->
</p>
<p style="text-align:left; font-size:x-small">
  <font color="slategray">
  ［訳注］この話題の詳細については
  「<a href="EmbeddingFScriptIntoCocoa-index-ja.html">Cocoa アプリケーションに F-Script を埋め込む</a>」を参照。
  </font><br>
</p>

<h2>
  最後に
  <!--
      Final thoughts
    -->
</h2>

<p>
  これまで Cocoa スクリプティングとはどのようなものかを見てきた。
  明らかに、Cocoa の例外の扱い方、インタフェースビルダーとの統合の方法、カスタム Objective-C クラスの使い方や、
  非オブジェクト型が、F-Script オブジェクトにどのようにマッピングされるのか、等々、この記事では議論されていないテーマがまだたくさんある。
  しかし、読者は、それらの側面についても非常に高いレベルで統合がなされていると期待して良い。
  <!--
      We have seen what scripting Cocoa with F-Script involves.
      Clearly, many subjects have not been tackled in this article,
      such as Cocoa exception handling, Interface Builder integration, usage of custom Objective-C classes or mapping of non-object types,
      but you can expect a very high level of integration on these aspects.
    -->
</p>


<br>
<p style="text-align:center; font-size:x-small">
  <font color="slategray">Copyright © 2006-2009 Philippe Mougin</font><br>
  <font color="slategray">Translation-ja © 2012 Hideo Haga［日本語版］</font>
</p>
<br>

<!--
    <script src="ScriptingCocoaWithFScript-index-ja_files/urchin.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      _uacct = "UA-278325-1";
      urchinTracker();
    </script>
    -->

</body></html>
